<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attributes Management</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h1>Source Attributes Management - <span id="analyzer-name"></span></h1>
        <p>Manage the source attributes for the selected risk model.</p>
    </div>
    <div class="attributes-management">
        <button onclick="goBack()">Back</button>
        <input type="text" id="search-bar" placeholder="Search attributes..." oninput="filterAttributes()" />
        <select id="category-filter" onchange="filterAttributes()">
            <option value="">All Categories</option>
            <option value="Demographics">Demographics</option>
            <option value="Vital Signs">Vital Signs</option>
            <option value="Cardiac Diseases">Cardiac Diseases</option>
            <option value="Other Conditions">Other Conditions</option>
            <option value="Medication Use">Medication Use</option>
            <option value="Diagnostic Results">Diagnostic Results</option>
            <option value="Social History">Social History</option>
        </select>
        <table>
            <thead>
                <tr>
                    <th>Select</th>
                    <th>Attribute Name</th>
                    <th>Category</th>
                    <th>Value/Details</th>
                    <th>Editable</th>
                    <th>Last Updated</th>
                </tr>
            </thead>
            <tbody id="attributes-tbody">
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Age</td>
                    <td>Demographics</td>
                    <td><input type="text" value="65" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Sex</td>
                    <td>Demographics</td>
                    <td>
                        <select>
                            <option value="Male" selected>Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Temp</td>
                    <td>Vital Signs</td>
                    <td><input type="text" value="98.6Â°F" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>SBP</td>
                    <td>Vital Signs</td>
                    <td><input type="text" value="120 mmHg" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>BP</td>
                    <td>Vital Signs</td>
                    <td><input type="text" value="120/80 mmHg" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Pulse</td>
                    <td>Vital Signs</td>
                    <td><input type="text" value="70 bpm" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>PR Interval</td>
                    <td>Vital Signs</td>
                    <td><input type="text" value="200" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Height</td>
                    <td>Vital Signs</td>
                    <td><input type="text" value="65 inches" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Weight</td>
                    <td>Vital Signs</td>
                    <td><input type="text" value="150 lbs" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>BMI</td>
                    <td>Vital Signs</td>
                    <td><input type="text" value="24.96" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Atrial Fibrillation</td>
                    <td>Cardiac Diseases</td>
                    <td>
                        <select>
                            <option value="No" selected>No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Left Ventricular Hypertrophy</td>
                    <td>Cardiac Diseases</td>
                    <td>
                        <select>
                            <option value="No" selected>No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Prevalent Heart Failure</td>
                    <td>Cardiac Diseases</td>
                    <td>
                        <select>
                            <option value="No" selected>No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Prior Cardiovascular Disease</td>
                    <td>Cardiac Diseases</td>
                    <td>
                        <select>
                            <option value="No" selected>No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Significant Murmur</td>
                    <td>Cardiac Diseases</td>
                    <td>
                        <select>
                            <option value="No" selected>No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Diabetes</td>
                    <td>Other Conditions</td>
                    <td>
                        <select>
                            <option value="No" selected>No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Prior Stroke or Ischemic Attack</td>
                    <td>Other Conditions</td>
                    <td>
                        <select>
                            <option value="No" selected>No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Hypertension Meds</td>
                    <td>Medication Use</td>
                    <td>
                        <select>
                            <option value="No" selected>No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Triglyceride level</td>
                    <td>Diagnostic Results</td>
                    <td><input type="text" placeholder="____ mg/dL" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Fasting glucose level</td>
                    <td>Diagnostic Results</td>
                    <td><input type="text" placeholder="____ mg/dL" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>HDL-C level</td>
                    <td>Diagnostic Results</td>
                    <td><input type="text" placeholder="____ mg/dL" /></td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>Smoking</td>
                    <td>Social History</td>
                    <td>
                        <select>
                            <option value="Non-smoker" selected>Non-smoker</option>
                            <option value="Smoker">Smoker</option>
                        </select>
                    </td>
                    <td><input type="checkbox" /></td>
                    <td>Last Updated: 2024-11-25, 2:30 PM</td>
                </tr>
            </tbody>
        </table>
        <div class="actions">
            <button onclick="showAuditLog()">View Audit Log</button>
            <button onclick="addNewAttribute()">Add New Attribute</button>
            <button onclick="saveAttributes()">Save Changes</button>
            <button onclick="resetChanges()">Reset Changes</button>
            <button onclick="exportAttributes()">Export Attributes</button>
        </div>
        <div id="save-message" style="display: none; color: green;">Your updates have been saved.</div>
    </div>
    <script src="attributes_management.js"></script>
    <script>
        function filterAttributes() {
            const searchValue = document.getElementById('search-bar').value.toLowerCase();
            const categoryValue = document.getElementById('category-filter').value;
            const rows = document.querySelectorAll('#attributes-tbody tr');

            rows.forEach(row => {
                const attributeName = row.cells[1].textContent.toLowerCase();
                const category = row.cells[2].textContent;

                const matchesSearch = attributeName.includes(searchValue);
                const matchesCategory = !categoryValue || category === categoryValue;

                if (matchesSearch && matchesCategory) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function saveAttributes() {
            const rows = document.querySelectorAll('#attributes-tbody tr');
            const selectedAttributes = Array.from(rows)
                .filter(row => row.querySelector('td input[type="checkbox"]').checked)
                .map(row => row.cells[1].textContent);

            const urlParams = new URLSearchParams(window.location.search);
            const index = urlParams.get('index');
            const riskAnalyzers = JSON.parse(localStorage.getItem('riskAnalyzers'));
            const analyzerName = riskAnalyzers[index].name;
            riskAnalyzers[index].attributes = selectedAttributes.join(', ');
            localStorage.setItem('riskAnalyzers', JSON.stringify(riskAnalyzers));
            localStorage.setItem(`selectedAttributes_${analyzerName}`, JSON.stringify(selectedAttributes));
            window.opener.renderRiskAnalyzers();
            document.getElementById('save-message').style.display = 'block';
            setTimeout(() => {
                document.getElementById('save-message').style.display = 'none';
            }, 3000);
        }

        function loadAttributes() {
            const urlParams = new URLSearchParams(window.location.search);
            const index = urlParams.get('index');
            const riskAnalyzers = JSON.parse(localStorage.getItem('riskAnalyzers'));
            const analyzer = riskAnalyzers[index];
            document.getElementById('analyzer-name').textContent = analyzer.name;
            const attributesArray = analyzer.attributes.split(', ');
            const rows = document.querySelectorAll('#attributes-tbody tr');
            rows.forEach(row => {
                if (attributesArray.includes(row.cells[1].textContent)) {
                    row.querySelector('td input[type="checkbox"]').checked = true;
                }
            });

            const selectedAttributes = JSON.parse(localStorage.getItem(`selectedAttributes_${analyzer.name}`)) || [];
            rows.forEach(row => {
                if (selectedAttributes.includes(row.cells[1].textContent)) {
                    row.querySelector('td input[type="checkbox"]').checked = true;
                }
            });
        }

        function goBack() {
            saveAttributes();
            window.history.back();
        }

        window.onload = loadAttributes;
    </script>
</body>
</html>
